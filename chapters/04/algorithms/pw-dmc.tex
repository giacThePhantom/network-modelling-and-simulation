\begin{algorithm}[H]
\DontPrintSemicolon
\SetKwComment{comment}{$\%$}{}
\SetKw{Int}{int}
\SetKw{To}{to}
\SetKw{Return}{return}
\SetKw{Not}{not}
\SetKw{Input}{Input}
\SetKw{Output}{Output}
\SetKwData{Item}{item}
\SetKwFunction{Min}{min}
\SetKwFunction{TitleFunction}{Probability-Weighted Dynamic Monte Carlo (PW-DMC)}

\caption{\protect\TitleFunction{}}
\label{algo:pw-dmc}

\Input: a biochemical reaction network of $M$ reactions in which each reaction $R_j$, $j=1, \dots, M$ is accompanied with the state change vector $\vec{v}_j$ and the propensity $a_j$, the initial state $\vec{x}_0$ at time $0$ and the simulation ending time $T_{\max}$, the size $b$ for discretizing probability of reacitons and tolerance $\epsilon$ for constraining the fluctuation of species.\;

\Output: a trajectory of the biochemical reaction network, which is a collection of states $X(t)$ for time $0\le t\le T_{\max}$\;

$t = 0$\;
$\vec{X} = \vec{x}_0$\;
build the reaction dependency graph $G$\;
compute propensity $a_j$ for each reaction $R_j$\;

\While{$t<T_{\max}$}{
	compute $w_j$ for each $R_j$\;
	compute $a_j^w = \frac{a_j}{w_j}$ for each $R_j$\;
	$a_0^w = \sum\limits_{j=1}^Ma_j^w$\;
	generate two random numbers $r_1, r_2\sim norm(0,1)$\;
	select $R_\mu$ with the smallest index $\mu$ such that $\sum\limits_{j=1}^\mu a^w_j\ge r_1a^w_0$\;
	$\tau = \frac{1}{a^w_0}\ln\frac{1}{r_2}$\;
	$\vec{X} = \vec{X}+w_\mu\vec{v}_\mu$\;
	$t=t+\tau$\;
	\ForEach{$R_j\in Dependents(R_\mu)$}{
		update $a_j$\;
	}
}

\end{algorithm}
