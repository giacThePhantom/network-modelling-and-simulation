\begin{algorithm}[H]
\DontPrintSemicolon
\SetKwComment{comment}{$\%$}{}
\SetKw{Int}{int}
\SetKw{To}{to}
\SetKw{Return}{return}
\SetKw{Not}{not}
\SetKw{Input}{Input}
\SetKw{Output}{Output}
\SetKw{False}{false}
\SetKw{True}{true}
\SetKwData{Item}{item}
\SetKwFunction{Min}{min}
\SetKwFunction{TitleFunction}{Implicit $\tau$-leaping method}

\caption{\protect\TitleFunction{}}
\label{algo:implicit-tau-leaping}

\Input: a biochemical reaction network of $M$ reactions in which each reaction $R_j$, $j=1, \dots, M$ is accompanied with the state change vector $\vec{v}_j$ and the propensity $a_j$, the initial state $\vec{x}_0$ at time $0$ and the simulation ending time $T_{\max}$ and the leap $\tau$\;

\Output: a trajectory of the biochemical reaction network, which is a collection of states $X(t)$ for time $0\le t\le T_{\max}$\;

$t = 0$\;
$\vec{X} = \vec{x}_0$\;
choose a leap $\tau$ value\;


\While{$t<T_{\max}$}{
	$a_0 = 0$\;

	\ForEach{$R_j\in$ Reactions}{
		compute $a_j$\;
		${a_0} = a_0 + a_j$\;
	}
	generate $M$ Poisson distributed random number $k_j\sim poi(a_j\tau)$\;
  $X(t+\tau) = \vec{x} + \sum\limits_{j=1}^M\left(k_j + [a_j(X(t+\tau))-a_j]\tau\right)\vec{v}_j$\;
	$t = t+\tau$\;

}
\end{algorithm}
